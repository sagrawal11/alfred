<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMS Assistant - Your Personal Butler</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Butler:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='landing.css') }}">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='Alfred.png') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='Alfred.png') }}">
</head>
<body>
    <!-- Header -->
    <header class="landing-header">
        <div class="header-content">
            <div class="logo-container">
                <img src="{{ url_for('static', filename='Alfred.png') }}" alt="Butler Logo" class="butler-logo">
                <span class="logo-text">Alfred</span>
            </div>
            <div class="header-actions">
                <button class="btn-auth" id="login-btn">Login</button>
                <button class="btn-auth" id="signup-btn">Sign Up</button>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <main class="hero-section">
        <div class="hero-content">
            <div class="hero-video-container">
                <!-- Video will be embedded here -->
                <video id="hero-video" class="hero-video" autoplay muted loop playsinline>
                    <source src="" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="landing-footer">
        <div class="footer-content">
            <a href="{{ url_for('dashboard_optin') }}" class="footer-link">Opt-In Policy</a>
            <span class="footer-separator">|</span>
            <a href="{{ url_for('dashboard_privacy') }}" class="footer-link">Privacy Policy</a>
            <span class="footer-separator">|</span>
            <a href="{{ url_for('dashboard_terms') }}" class="footer-link">Terms and Conditions</a>
        </div>
    </footer>

    <!-- Login Modal -->
    <div id="login-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close" id="login-close">&times;</span>
            <h2>Login</h2>
            <div id="login-error" class="modal-error" style="display: none;"></div>
            <form id="login-form" method="POST" action="{{ url_for('dashboard_login') }}">
                <div class="form-group">
                    <label for="login-email">Email:</label>
                    <input type="email" id="login-email" name="email" required autofocus>
                </div>
                <div class="form-group">
                    <label for="login-password">Password:</label>
                    <input type="password" id="login-password" name="password" required>
                </div>
                <button type="submit" class="btn-modal">Login</button>
            </form>
            <div class="modal-footer">
                <p><a href="{{ url_for('dashboard_forgot_password') }}">Forgot Password?</a></p>
                <p>Don't have an account? <a href="#" id="switch-to-signup">Sign Up</a></p>
            </div>
        </div>
    </div>

    <!-- Sign Up Modal -->
    <div id="signup-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close" id="signup-close">&times;</span>
            <h2>Create Account</h2>
            <div id="signup-error" class="modal-error" style="display: none;"></div>
            <form id="signup-form" method="POST" action="{{ url_for('dashboard_register') }}">
                <div class="form-group">
                    <label for="signup-email">Email:</label>
                    <input type="email" id="signup-email" name="email" required autofocus>
                </div>
                <div class="form-group">
                    <label for="signup-password">Password:</label>
                    <input type="password" id="signup-password" name="password" required minlength="8">
                    <small>Must be at least 8 characters</small>
                </div>
                <div class="form-group">
                    <label for="signup-password-confirm">Confirm Password:</label>
                    <input type="password" id="signup-password-confirm" name="password_confirm" required>
                </div>
                <div class="form-group">
                    <label for="signup-name">Name:</label>
                    <input type="text" id="signup-name" name="name" required>
                </div>
                <div class="form-group">
                    <label for="signup-phone">Phone Number:</label>
                    <input type="tel" id="signup-phone" name="phone_number" placeholder="+1 (123) 456-7890" required inputmode="tel" autocomplete="tel">
                    <small>US numbers only (weâ€™ll format it as you type)</small>
                </div>
                <input type="hidden" id="signup-timezone" name="timezone" value="">
                <button type="submit" class="btn-modal">Register</button>
            </form>
            <div class="modal-footer">
                <p>Already have an account? <a href="#" id="switch-to-login">Login</a></p>
            </div>
        </div>
    </div>

    <script>
        // Modal functionality
        const loginBtn = document.getElementById('login-btn');
        const signupBtn = document.getElementById('signup-btn');
        const loginModal = document.getElementById('login-modal');
        const signupModal = document.getElementById('signup-modal');
        const loginClose = document.getElementById('login-close');
        const signupClose = document.getElementById('signup-close');
        const switchToSignup = document.getElementById('switch-to-signup');
        const switchToLogin = document.getElementById('switch-to-login');

        // Open login modal
        loginBtn.addEventListener('click', () => {
            loginModal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        });

        // Open signup modal
        signupBtn.addEventListener('click', () => {
            signupModal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        });

        // Close modals
        loginClose.addEventListener('click', () => {
            loginModal.style.display = 'none';
            document.body.style.overflow = '';
        });

        signupClose.addEventListener('click', () => {
            signupModal.style.display = 'none';
            document.body.style.overflow = '';
        });

        // Switch between modals
        switchToSignup.addEventListener('click', (e) => {
            e.preventDefault();
            loginModal.style.display = 'none';
            signupModal.style.display = 'flex';
        });

        switchToLogin.addEventListener('click', (e) => {
            e.preventDefault();
            signupModal.style.display = 'none';
            loginModal.style.display = 'flex';
        });

        // Close modal when clicking outside
        window.addEventListener('click', (e) => {
            if (e.target === loginModal) {
                loginModal.style.display = 'none';
                document.body.style.overflow = '';
            }
            if (e.target === signupModal) {
                signupModal.style.display = 'none';
                document.body.style.overflow = '';
            }
        });

        // Handle form submissions with error display
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const errorDiv = document.getElementById('login-error');
            errorDiv.style.display = 'none';
            
            try {
                const response = await fetch('{{ url_for("dashboard_login") }}', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Success - redirect to dashboard
                    window.location.href = data.redirect || '/dashboard';
                } else {
                    // Error - show error message
                    errorDiv.textContent = data.error || 'Login failed. Please check your credentials.';
                    errorDiv.style.display = 'block';
                }
            } catch (error) {
                errorDiv.textContent = 'An error occurred. Please try again.';
                errorDiv.style.display = 'block';
            }
        });

        // Set timezone on signup (best-effort)
        try {
            const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
            const tzInput = document.getElementById('signup-timezone');
            if (tzInput && tz) tzInput.value = tz;
        } catch (e) {}

        // Phone formatting: +1 (123) 456-7890
        const phoneInput = document.getElementById('signup-phone');
        function toDigits(s) {
            return (s || '').replace(/\D/g, '');
        }
        function formatUSPhone(digitsRaw) {
            let d = (digitsRaw || '').slice(0, 11);
            if (d.startsWith('1')) d = d.slice(1);
            const a = d.slice(0, 3);
            const b = d.slice(3, 6);
            const c = d.slice(6, 10);
            if (!a) return '+1 ';
            if (a.length < 3) return `+1 (${a}`;
            if (!b) return `+1 (${a}) `;
            if (b.length < 3) return `+1 (${a}) ${b}`;
            if (!c) return `+1 (${a}) ${b}-`;
            return `+1 (${a}) ${b}-${c}`;
        }
        function toE164US(inputValue) {
            const digits = toDigits(inputValue);
            if (!digits) return null;
            if (digits.length === 10) return `+1${digits}`;
            if (digits.length === 11 && digits.startsWith('1')) return `+${digits}`;
            // Some users may paste +1XXXXXXXXXX (digits=11) or formatted variants; handled above.
            return null;
        }
        if (phoneInput) {
            phoneInput.addEventListener('input', () => {
                const digits = toDigits(phoneInput.value);
                phoneInput.value = formatUSPhone(digits);
            });
            // If browser autofills, format once on load
            setTimeout(() => {
                const digits = toDigits(phoneInput.value);
                if (digits) phoneInput.value = formatUSPhone(digits);
            }, 0);
        }

        document.getElementById('signup-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const errorDiv = document.getElementById('signup-error');
            errorDiv.style.display = 'none';
            
            // Client-side validation
            const name = document.getElementById('signup-name').value.trim();
            const phone = document.getElementById('signup-phone').value.trim();
            const password = document.getElementById('signup-password').value;
            const passwordConfirm = document.getElementById('signup-password-confirm').value;
            
            if (!name) {
                errorDiv.textContent = 'Name is required.';
                errorDiv.style.display = 'block';
                return;
            }
            
            if (!phone) {
                errorDiv.textContent = 'Phone number is required.';
                errorDiv.style.display = 'block';
                return;
            }

            const e164 = toE164US(phone);
            if (!e164) {
                errorDiv.textContent = 'Please enter a valid US phone number (10 digits).';
                errorDiv.style.display = 'block';
                return;
            }
            formData.set('phone_number', e164);
            
            if (password !== passwordConfirm) {
                errorDiv.textContent = 'Passwords do not match.';
                errorDiv.style.display = 'block';
                return;
            }
            
            if (password.length < 8) {
                errorDiv.textContent = 'Password must be at least 8 characters.';
                errorDiv.style.display = 'block';
                return;
            }
            
            try {
                const response = await fetch('{{ url_for("dashboard_register") }}', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Success - show message and redirect
                    if (data.message) {
                        alert(data.message);
                    }
                    window.location.href = data.redirect || '/dashboard';
                } else {
                    // Error - show error message
                    errorDiv.textContent = data.error || 'Registration failed. Please try again.';
                    errorDiv.style.display = 'block';
                }
            } catch (error) {
                errorDiv.textContent = 'An error occurred. Please try again.';
                errorDiv.style.display = 'block';
            }
        });
    </script>
</body>
</html>
